# 应用层协议原理

## 网络应用程序体系结构

1、**客户 - 服务器体系架构**（client-server architecture）

+ 服务器主机总是打开，接收客户主机请求
+ 客户之间不相互通信

2、**P2P体系结构**

+ 对数据中心的专用服务器仅有最小依赖
+ 标识：发起通信为客户，等待联系为服务器
+ 间断连接的主机间使用直接通信
  + 这样的一组主机称对等方
+ **自扩展性** self-scalability
  + 向对等方发送文件
  + 请求产生工作负载，但也为系统增加服务能力

## 进程通信

1、进程 process

+ def：运行在端系统的一个程序
+ 通信进程对：每对两个进程互相发送报文
+ **进程寻址**的要求
  + 主机地址
  + 目的主机需指定接收进程的标识符

2、套接字 socket：向网络发送 / 接收报文的软件接口

3、应用程序编程接口 *API*

+ 建立网络应用程序的可编程接口
+ 运输层的控制
  + 选择运输层协议
  + 部分运输层参数

## 可供应用程序使用的运输服务

1、**可靠数据传输**：正确、完全地交付数据

2、吞吐量

+ 带宽敏感 / 弹性应用

3、**定时保证**

+ 交互式实时应用

4、安全性

## 因特网提供的运输服务

1、TCP服务

+ 面向连接：流动前互换运输层控制信息，结束后拆除连接
+ 可靠数据传送：无差错、按适当顺序交付
+ **拥塞控制**
+ 无加密机制
  + 改进：*安全套接字层（Secure Socket Layer，SSL）

2、UDP服务

+ 轻量级，仅提供最小服务
+ 不可靠数据传送：不保证到达、可乱序
+ 可选定数据的传输速率
+ 无加密机制

## 应用层协议

1、RFC（Request For Comments）文档：一系列以编号排定的文件

+ 位于公共域中
+ 收录几乎所有互联网标准

2、超文本传输协议 HTTP

3、简单邮件传输协议 SMTP

# HyperText Transfer Protocol

1、超文本传输协议 HTTP

+ 定义报文的结构和客户、服务器进行报文交换的方式
+ 实现：一个客户程序和一个服务器程序（P65）
+ 支撑运输协议：*TCP*
+ 无状态协议 stateless protocol：不保存关于客户的任何信息

2、连接方式

+  **非持续连接** non-persistent connection
  + 请求 / 响应经一单独TCP连接发送
  + 为每个请求对象建立和维护一个全新连接
  + **三次握手**：发送确认*RTT* - 返回确认*RTT* - 传输
    + 往返时间 Round-Trip Time，*RTT*
+ **持续连接**（默认）
  + 请求 / 响应经相同的TCP连接发送
  + 带流水线（默认）：对对象的请求可依次发出，不必等待未决请求

3、报文格式

**请求报文（P68，CR回车，LF换行）**

+ 组成：
  + 第一行称**请求行** request line
    + 三个部分：方法字段 URL字段 HTTP字段
  + 后继行称**首部行** header line
  + 实体体 entity body：POST方法使用
+ 方法字段：GET POST HEAD PUT DELETE
  + GET：请求对象、提交表单（HTML表单）
  + POST：提交表单
  + HEAD：响应请求，但不返回对象
    + *试跟踪
  + PUT：常与Web发行工具共用，上传对象到指定Web服务器指定路径
  + DELETE：允许删除Web服务器上对象

**响应报文（P69）**

+ 组成
  + 状态行 status line 
    + 三个部分：协议版本字段 状态码 相应状态信息
  + 首部行和实体体
+ 常见状态码：200 OK；301请求对象已经永久转移；400/404；505 不支持的HTTP协议版本

4、Cookie

+ 组成
  + 响应报文中的一个cookie首部行
  + 请求报文中的一个cookie首部行
  + 用户端系统保留的一个cookie文件
  + 位于Web站点的一个后端数据库
+ **识别码** Set-cookie：用于标识一个用户
  + *用户隐私侵害

5、Web缓存

+ Web缓存器 Web Cache / 代理服务器 *proxy server*
  + 配置后的浏览器请求被定向至代理服务器
  + 发送给用户服务器的是保存的一份**副本**
  + 从整体上大大降低因特网的流量
+ 内容分发网络 Content Distribution Network，CDN：使大量流量实现本地化
+ **条件Get方法**：执行最新检查
  + If-Modified-Since = Last-Modified -> 304 Not Modified

# 电子邮件